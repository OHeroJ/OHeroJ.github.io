<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="oheroj iOS python" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="loveli">
<meta property="og:url" content="http://loveli.site/index.html">
<meta property="og:site_name" content="loveli">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="loveli">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6263237426282497000,
      author: '博主'
    }
  };
</script>

  <title> loveli -  </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">loveli</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">浮生流年</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/08/Swift-之惰性求值/" itemprop="url">
                  Swift 之惰性求值
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-12-08T11:25:13+08:00" content="2017-12-08">
              2017-12-08
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/12/08/Swift-之惰性求值/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/12/08/Swift-之惰性求值/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在 <code>Haskell</code> 中的函数有一个特性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">函数的返回可能是一个块(一个被延迟计算的表达式)</div></pre></td></tr></table></figure>
<p>从而引出一个概念 <code>惰性求值</code></p>
<figure class="highlight hs"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">isOdd</span> n = mod n <span class="number">2</span> == <span class="number">1</span></div></pre></td></tr></table></figure>
<p>下面有段 <a href="https://rwh.readthedocs.io/en/latest/chp/2.html#function-types" target="_blank" rel="external">分析</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">在使用严格求值的语言里，函数的参数总是在应用函数之前被求值。以 isOdd 为例子：子表达式 (1 + 2)</div><div class="line">会首先被求值，得出结果 3 。接着，将 3 绑定到变量 n ，应用到函数 isOdd 。最后， mod 3 2 返回</div><div class="line">1 ，而 1 == 1 返回 True 。</div><div class="line"></div><div class="line">Haskell 使用了另外一种求值方式 —— 非严格求值。在这种情况下，求值 isOdd (1 + 2) 并不会即刻使得</div><div class="line">子表达式 1 + 2 被求值为 3 ，相反，编译器做出了一个“承诺”，说，“当真正有需要的时候，我有办法计算</div><div class="line">出 isOdd (1 + 2) 的值”。</div></pre></td></tr></table></figure>
<h2 id="惰性求值的优点"><a href="#惰性求值的优点" class="headerlink" title="惰性求值的优点"></a>惰性求值的优点</h2><p>简单理解<code>惰性求值</code>: 在使用惰性计算时，表达式不在它被绑定到变量之后就立即求值，而是在该值被取用的时候求值。</p>
<ul>
<li>可以创建无限序列数据类型， 比如无穷大，由于字节的限制，很多语言并不能描述出无穷大</li>
<li>减少存储空间, 在要求值的时候才会发生计算。 这个跟 <code>lazy</code> 属性一样的作用</li>
<li>减少计算量, 例如，寻找数组中符合条件的某个值</li>
</ul>
<p>swift 默认<code>严格求值</code>, 也提供了相关的惰性求值的机制</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> array = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">7</span>]</div><div class="line"><span class="keyword">let</span> selement = array.<span class="built_in">map</span>(&#123;$<span class="number">0</span> * <span class="number">2</span>&#125;)[<span class="number">3</span>]</div><div class="line"><span class="keyword">let</span> element = array.<span class="built_in">lazy</span>.<span class="built_in">map</span>(&#123;$<span class="number">0</span> * <span class="number">2</span> &#125;)[<span class="number">3</span>]</div><div class="line"><span class="built_in">print</span>(<span class="string">"\(selement) -- \(element)"</span>)</div></pre></td></tr></table></figure>
<p>上面代码中， 计算出 <code>selement</code> 花了 <code>7</code> 次， 计算 <code>element</code> 花了 <code>2</code> 次</p>
<ul>
<li>对于 <code>7</code>：将 array 每个元素分别取出 <code>* 2</code>，然后在这些数据中取出第4个元素, 6+1=7</li>
<li>对于 <code>2</code>：因为是惰性求值，会先从 array 取出第4个元素， 然后 <code>* 2</code> , 1+1 = 2</li>
</ul>
<h2 id="lazy-到底为何物"><a href="#lazy-到底为何物" class="headerlink" title="lazy 到底为何物?"></a><code>lazy</code> 到底为何物?</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">var</span> <span class="built_in">lazy</span>: <span class="type">LazyRandomAccessCollection</span>&lt;<span class="type">Array</span>&lt;<span class="type">Element</span>&gt;&gt; &#123; <span class="keyword">get</span> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>LazyRandomAccessCollection</code>  Conforms To<br><code>LazyCollectionProtocol</code></p>
<p><code>LazyCollectionProtocol</code> Conforms To<br><code>LazySequenceProtocol</code></p>
<h2 id="构建无穷大序列-swift4"><a href="#构建无穷大序列-swift4" class="headerlink" title="构建无穷大序列 (swift4)"></a>构建无穷大序列 (swift4)</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Stream</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">case</span> empty</div><div class="line">    <span class="keyword">case</span> cons(()-&gt;<span class="type">T</span>, ()-&gt; <span class="type">Stream</span>&lt;<span class="type">T</span>&gt;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Stream</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> empty: <span class="type">Stream</span>&lt;<span class="type">T</span>&gt; &#123;</div><div class="line">        <span class="keyword">return</span> .empty</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> tail: <span class="type">Stream</span>&lt;<span class="type">T</span>&gt; &#123;</div><div class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</div><div class="line">        <span class="keyword">case</span> .empty:</div><div class="line">            <span class="keyword">return</span> .empty</div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .cons(<span class="number">_</span>, tail):</div><div class="line">            <span class="keyword">return</span> tail()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> toArray: [<span class="type">T</span>] &#123;</div><div class="line">        <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</div><div class="line">        <span class="keyword">case</span> .empty:</div><div class="line">            <span class="keyword">return</span> []</div><div class="line">        <span class="keyword">case</span> <span class="keyword">let</span> .cons(h, t):</div><div class="line">            <span class="keyword">return</span> [h()] + t().toArray</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">take</span><span class="params">(n: Int)</span></span> -&gt; <span class="type">Stream</span>&lt;<span class="type">T</span>&gt; &#123;</div><div class="line">        <span class="keyword">if</span> n == <span class="number">0</span> &#123;</div><div class="line">            <span class="keyword">return</span> empty</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">switch</span> <span class="keyword">self</span> &#123;</div><div class="line">            <span class="keyword">case</span> .empty:</div><div class="line">                <span class="keyword">return</span> .empty</div><div class="line">            <span class="keyword">case</span> <span class="keyword">let</span> .cons(h, t):</div><div class="line">                <span class="keyword">return</span> <span class="type">Stream</span>.cons(h, &#123;t().take(n: n-<span class="number">1</span>)&#125;)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">onses</span><span class="params">()</span></span> -&gt; <span class="type">Stream</span>&lt;<span class="type">Int</span>&gt; &#123;</div><div class="line">    <span class="keyword">return</span> <span class="type">Stream</span>&lt;<span class="type">Int</span>&gt;.cons(&#123;<span class="number">1</span>&#125;, &#123;onses()&#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">print</span>(onses().take(n: <span class="number">5</span>).toArray)</div></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://lincode.github.io/Swift-Lazy" target="_blank" rel="external">Swift 函数式编程－惰性计算</a></li>
<li><a href="http://www.bijishequ.com/detail/266436?p=" target="_blank" rel="external">Swift函数式编程(二)：惰性求值与无穷数据流</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/27/Vapor2-之数据库迁移/" itemprop="url">
                  Vapor2 之数据库迁移
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-11-27T15:28:24+08:00" content="2017-11-27">
              2017-11-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/11/27/Vapor2-之数据库迁移/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/11/27/Vapor2-之数据库迁移/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前一直不知道如何处理 vapor 如何实现对原表的修改，今天终于明白了！顿时感觉自己好傻</p>
<blockquote>
<p>Preparations相当于迁移，因为它允许修改已经创建的模式</p>
</blockquote>
<h1 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h1><p>一般一个模型对应一张表，那么如果这个模型已建立好，并且改表已生成，但在未来的某一天，表中的结构需要更改，你只需要创建一个遵守  Preparation 协议的类或结构体：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AddFooToBar</span>: <span class="title">Preparation</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">prepare</span><span class="params">(<span class="number">_</span> database: Database)</span></span> <span class="keyword">throws</span> &#123;</div><div class="line">        <span class="comment">/// bar 是表名</span></div><div class="line">        <span class="keyword">try</span> database.modify(<span class="type">Bar</span>.<span class="keyword">self</span>, closure: &#123; bar <span class="keyword">in</span></div><div class="line">            bar.string(<span class="string">"foo"</span>, length: <span class="number">150</span>, <span class="keyword">optional</span>: <span class="literal">false</span>, unique: <span class="literal">false</span>, <span class="keyword">default</span>: <span class="literal">nil</span>)</div><div class="line">        &#125;)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">revert</span><span class="params">(<span class="number">_</span> database: Database)</span></span> <span class="keyword">throws</span> &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后记得 <code>drop.preparations.append(AddFooToBar.self)</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/27/Swift-Vapor2-在-Ubuntu-1分钟搭建完成/" itemprop="url">
                  Swift Vapor2 在 Ubuntu 1分钟搭建完成
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-11-27T13:07:39+08:00" content="2017-11-27">
              2017-11-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/11/27/Swift-Vapor2-在-Ubuntu-1分钟搭建完成/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/11/27/Swift-Vapor2-在-Ubuntu-1分钟搭建完成/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="运行环境："><a href="#运行环境：" class="headerlink" title="运行环境："></a>运行环境：</h2><ul>
<li>Ubuntu 16.04</li>
<li>ssh</li>
</ul>
<h2 id="ssh-登入"><a href="#ssh-登入" class="headerlink" title="ssh 登入"></a>ssh 登入</h2><p>ssh -p 端口 xx@ip  (ssh 默认是22端口)</p>
<p>可以指定端口，例如: ssh -p 123 root@98.1.2.3</p>
<h2 id="运行脚本"><a href="#运行脚本" class="headerlink" title="运行脚本"></a>运行脚本</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(curl -sL https://apt.vapor.sh)</span>"</span></div></pre></td></tr></table></figure>
<h2 id="安装-swift-和-vapor"><a href="#安装-swift-和-vapor" class="headerlink" title="安装 swift 和 vapor"></a>安装 swift 和 vapor</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install swift vapor</div></pre></td></tr></table></figure>
<p>结果 ：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">~<span class="comment"># swift --version</span></div><div class="line">Swift version 4.0.2 (swift-4.0.2-RELEASE)</div><div class="line">Target: x86_64-unknown-linux-gnu</div><div class="line">~<span class="comment"># vapor --version</span></div><div class="line">Vapor Toolbox: 3.1.2</div><div class="line">~<span class="comment">#</span></div></pre></td></tr></table></figure>
<h2 id="创建-Hello-world"><a href="#创建-Hello-world" class="headerlink" title="创建 Hello world"></a>创建 Hello world</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vapor new helloworld</div></pre></td></tr></table></figure>
<p><code>tree</code> 结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">-- helloworld</div><div class="line">    |-- circle.yml</div><div class="line">    |-- cloud.yml</div><div class="line">    |-- Config</div><div class="line">    |   |-- app.json</div><div class="line">    |   |-- crypto.json</div><div class="line">    |   |-- droplet.json</div><div class="line">    |   |-- fluent.json</div><div class="line">    |   `-- server.json</div><div class="line">    |-- license</div><div class="line">    |-- Package.resolved</div><div class="line">    |-- Package.swift</div><div class="line">    |-- Public</div><div class="line">    |-- README.md</div><div class="line">    |-- Sources</div><div class="line">    |   |-- App</div><div class="line">    |   |   |-- Controllers</div><div class="line">    |   |   |   `-- PostController.swift</div><div class="line">    |   |   |-- Models</div><div class="line">    |   |   |   `-- Post.swift</div><div class="line">    |   |   |-- Routes</div><div class="line">    |   |   |   `-- Routes.swift</div><div class="line">    |   |   `-- Setup</div><div class="line">    |   |       |-- Config+Setup.swift</div><div class="line">    |   |       `-- Droplet+Setup.swift</div><div class="line">    |   `-- Run</div><div class="line">    |       `-- main.swift</div><div class="line">    `-- Tests</div><div class="line">        |-- AppTests</div><div class="line">        |   |-- PostControllerTests.swift</div><div class="line">        |   |-- RouteTests.swift</div><div class="line">        |   `-- Utilities.swift</div><div class="line">        `-- LinuxMain.swift</div></pre></td></tr></table></figure>
<p>在 <code>Sources/App/Routes/Routes.swift</code> 可以看到:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Droplet</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setupRoutes</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</div><div class="line">        <span class="keyword">get</span>(<span class="string">"hello"</span>) &#123; req <span class="keyword">in</span></div><div class="line">            <span class="keyword">var</span> json = <span class="type">JSON</span>()</div><div class="line">            <span class="keyword">try</span> json.<span class="keyword">set</span>(<span class="string">"hello"</span>, <span class="string">"world"</span>)</div><div class="line">            <span class="keyword">return</span> json</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">get</span>(<span class="string">"plaintext"</span>) &#123; req <span class="keyword">in</span></div><div class="line">            <span class="keyword">return</span> <span class="string">"Hello, world!"</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// response to requests to /info domain</span></div><div class="line">        <span class="comment">// with a description of the request</span></div><div class="line">        <span class="keyword">get</span>(<span class="string">"info"</span>) &#123; req <span class="keyword">in</span></div><div class="line">            <span class="keyword">return</span> req.description</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">get</span>(<span class="string">"description"</span>) &#123; req <span class="keyword">in</span> <span class="keyword">return</span> req.description &#125;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> resource(<span class="string">"posts"</span>, <span class="type">PostController</span>.<span class="keyword">self</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="运行项目"><a href="#运行项目" class="headerlink" title="运行项目"></a>运行项目</h2><h3 id="vapor-相关命令"><a href="#vapor-相关命令" class="headerlink" title="vapor 相关命令"></a>vapor 相关命令</h3><ul>
<li>vapor build 编译</li>
<li>vapor run serve  运行</li>
</ul>
<p>更多命令可以</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># vapor --help</span></div><div class="line">Usage: vapor <span class="built_in">command</span></div><div class="line"></div><div class="line">Join our Slack <span class="keyword">if</span> you have questions, need <span class="built_in">help</span>,</div><div class="line">or want to contribute: http://vapor.team</div><div class="line"></div><div class="line">Commands:</div><div class="line">       new Creates a new Vapor application from a template.</div><div class="line">           Use --template=repo/template <span class="keyword">for</span> github templates</div><div class="line">           Use --template=full-url-here.git <span class="keyword">for</span> non github templates</div><div class="line">           Use --web to create a new web app</div><div class="line">           Use --auth to create a new authenticated API app</div><div class="line">           Use --api (default) to create a new API</div><div class="line">     build Compiles the application.</div><div class="line">       run Runs the compiled application.</div><div class="line">     fetch Fetches the application<span class="string">'s dependencies.</span></div><div class="line">    update Updates your dependencies.</div><div class="line">     clean Cleans temporary files--usually fixes</div><div class="line">           a plethora of bizarre build errors.</div><div class="line">      test Runs the application's tests.</div><div class="line">     xcode Generates an Xcode project <span class="keyword">for</span> development.</div><div class="line">           Additionally links commonly used libraries.</div><div class="line">   version Displays Vapor CLI version</div><div class="line">     cloud Commands <span class="keyword">for</span> interacting with Vapor Cloud.</div><div class="line">    heroku Commands to <span class="built_in">help</span> deploy to Heroku.</div><div class="line">  provider Commands to <span class="built_in">help</span> manage providers.</div><div class="line"></div><div class="line">Use `vapor <span class="built_in">command</span> --help` <span class="keyword">for</span> more information on a command.</div></pre></td></tr></table></figure>
<p>我们执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vapor run serve</div></pre></td></tr></table></figure>
<h2 id="打开浏览器访问"><a href="#打开浏览器访问" class="headerlink" title="打开浏览器访问"></a>打开浏览器访问</h2><p>Config/server.json 中可以看到</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"//"</span>: <span class="string">"The $PORT:8080 call tells the json file to see if there"</span>,</div><div class="line">    <span class="attr">"//"</span>: <span class="string">"is any value at the 'PORT' environment variable."</span>,</div><div class="line">    <span class="attr">"//"</span>: <span class="string">"If there is no value there, it will fallback to '8080'"</span>,</div><div class="line">    <span class="attr">"port"</span>: <span class="string">"$PORT:8080"</span>,</div><div class="line"></div><div class="line">    <span class="attr">"host"</span>: <span class="string">"0.0.0.0"</span>,</div><div class="line"></div><div class="line">    <span class="attr">"//"</span>: <span class="string">"It's very rare that a server manages its own TLS."</span>,</div><div class="line">    <span class="attr">"//"</span>: <span class="string">"More commonly, vapor is served behind a proxy like nginx."</span>,</div><div class="line">    <span class="attr">"securityLayer"</span>: <span class="string">"none"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>默认是 8080 端口，那我们可以直接在浏览器中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://&lt;yourip&gt;:8080/hello</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/04/RxSwift-对-MJRefresh-使用的封装/" itemprop="url">
                  RxSwift 对 MJRefresh 使用的封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-11-04T17:35:38+08:00" content="2017-11-04">
              2017-11-04
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/11/04/RxSwift-对-MJRefresh-使用的封装/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/11/04/RxSwift-对-MJRefresh-使用的封装/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对于一个很常用的两个库， MJRefresh 如何可以像 UIButton 使用方式呢：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">btn.rx.tap.subscribe(...)</div></pre></td></tr></table></figure>
<p>代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"><span class="keyword">import</span> MJRefresh</div><div class="line"><span class="keyword">import</span> RxSwift</div><div class="line"><span class="keyword">import</span> RxCocoa</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RxTarget</span>: <span class="title">NSObject</span>, <span class="title">Disposable</span> </span>&#123;  <span class="comment">// RxTarget 是 Rxswift 源码</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> retainSelf: <span class="type">RxTarget</span>?</div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">        <span class="keyword">self</span>.retainSelf = <span class="keyword">self</span></div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dispose</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">self</span>.retainSelf = <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RefreshTarget</span>&lt;<span class="title">Component</span>:<span class="title">MJRefreshComponent</span>&gt;: <span class="title">RxTarget</span> </span>&#123;</div><div class="line">    <span class="keyword">typealias</span> <span class="type">Callback</span> = <span class="type">MJRefreshComponentRefreshingBlock</span></div><div class="line">    <span class="keyword">var</span> callback: <span class="type">Callback</span>?</div><div class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> component:<span class="type">Component</span>?</div><div class="line"></div><div class="line">    <span class="keyword">let</span> selector = #selector(<span class="type">RefreshTarget</span>.eventHandler)</div><div class="line"></div><div class="line">    <span class="keyword">init</span>(<span class="number">_</span> component: <span class="type">Component</span>,callback:@escaping <span class="type">Callback</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.callback = callback</div><div class="line">        <span class="keyword">self</span>.component = component</div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">        component.setRefreshingTarget(<span class="keyword">self</span>, refreshingAction: selector)</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@objc</span> <span class="function"><span class="keyword">func</span> <span class="title">eventHandler</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">if</span> <span class="keyword">let</span> callback = <span class="keyword">self</span>.callback &#123;</div><div class="line">            callback()</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">dispose</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.dispose()</div><div class="line">        <span class="keyword">self</span>.component?.refreshingBlock = <span class="literal">nil</span></div><div class="line">        <span class="keyword">self</span>.callback = <span class="literal">nil</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Reactive</span> <span class="title">where</span> <span class="title">Base</span>: <span class="title">MJRefreshComponent</span> </span>&#123;</div><div class="line">    <span class="keyword">var</span> event: <span class="type">ControlEvent</span>&lt;<span class="type">Base</span>&gt; &#123;</div><div class="line">        <span class="keyword">let</span> source: <span class="type">Observable</span>&lt;<span class="type">Base</span>&gt; = <span class="type">Observable</span>.create &#123; [<span class="keyword">weak</span> control = <span class="keyword">self</span>.base] observer  <span class="keyword">in</span></div><div class="line">            <span class="type">MainScheduler</span>.ensureExecutingOnScheduler()</div><div class="line">            <span class="keyword">guard</span> <span class="keyword">let</span> control = control <span class="keyword">else</span> &#123;</div><div class="line">                observer.on(.completed)</div><div class="line">                <span class="keyword">return</span> <span class="type">Disposables</span>.create()</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">let</span> observer = <span class="type">RefreshTarget</span>(control) &#123;</div><div class="line">                observer.on(.next(control))</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> observer</div><div class="line">        &#125;.takeUntil(deallocated)</div><div class="line">        <span class="keyword">return</span> <span class="type">ControlEvent</span>(events: source)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/01/LaunchScreen-storyboard-换图的问题/" itemprop="url">
                  LaunchScreen.storyboard 换图的问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-11-01T13:29:52+08:00" content="2017-11-01">
              2017-11-01
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/11/01/LaunchScreen-storyboard-换图的问题/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/11/01/LaunchScreen-storyboard-换图的问题/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>之前设置了<code>LaunchScreen.storyboard</code>，在这个storyboard中加了一个imageView，里面设置了一张图片launch.png，今天需要更换这个启动<br>图片，我就直接去工程里面，把launch.png,launch@2x.png,launch@3x.png这三张图片直接用其他图片覆盖了<br>，然后打开这个storyboard，这个storyboard里面的imageView的确变了，但是运行工程，并没有改变，显示的还是原来的图片</p>
</blockquote>
<p>有人提出这两种办法:</p>
<ol>
<li>删除重新安装，删除driverData，但是并没有卵用，老图片还是顽固的存在</li>
<li>把这个storyboard的Use as launch Screen选项取消掉，然后再重新选择</li>
</ol>
<p>但是，并没有卵用。</p>
<p>正确的解决办法是 <code>Assets.xcassets</code> 替换图片的时候，把图片名字也替换掉。然后在 <code>LaunchScreen.storyboard</code> 更换用新的图片名字即可。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/27/免邀请码注册登入的一种设计邀请奖励机制/" itemprop="url">
                  免邀请码注册登入的一种设计邀请奖励机制
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-27T13:16:23+08:00" content="2017-10-27">
              2017-10-27
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/10/27/免邀请码注册登入的一种设计邀请奖励机制/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/27/免邀请码注册登入的一种设计邀请奖励机制/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://obp26pczx.bkt.clouddn.com/Screen Shot 2017-10-27 at 1.13.41 PM.png" alt="Screen Shot 2017-10-27 at 1.13.41 P"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/26/Swift-全栈再书App/" itemprop="url">
                  swift 全栈再书App
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-26T14:34:54+08:00" content="2017-10-26">
              2017-10-26
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/10/26/Swift-全栈再书App/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/26/Swift-全栈再书App/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="再书"><a href="#再书" class="headerlink" title="再书"></a>再书</h1><p>很高兴终于审核通过了，本人第一个全栈 app：</p>
<p><img src="http://obp26pczx.bkt.clouddn.com/Group@2x.png" alt="Group@2x"></p>
<p>后台 github 地址： <a href="https://github.com/OHeroJ/twicebook" target="_blank" rel="external">twicebook</a></p>
<p>have a try! welcome</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/09/全栈后台上线之Swift-Vapor/" itemprop="url">
                  全栈后台上线之Swift Vapor
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-09T14:34:12+08:00" content="2017-10-09">
              2017-10-09
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/10/09/全栈后台上线之Swift-Vapor/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/10/09/全栈后台上线之Swift-Vapor/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>近期做了个 App《再书》，即将上线，独立开发，不管后期产品如何，还是来总结一下后台方面的一些问题，以免下次犯错。</p>
<ul>
<li>上线服务器选择</li>
<li>数据库选择</li>
<li>环境搭建</li>
</ul>
<h2 id="上线服务器选择"><a href="#上线服务器选择" class="headerlink" title="上线服务器选择"></a>上线服务器选择</h2><p>一开始的时候，鉴于资金有限，且是第一个独立的 App, 我首先在网上搜集了一些资源，初期基本上对这块云服务不是很了解，通过简单的了解，以及公司的服务器采用的借鉴，我买了个阿里云的云服务其 ECS ， 然后当时并没有注意到一个问题，买了个 32位的 ubuntu 服务器。 我只能说我就是个傻帽。在安装 swift 的时候，发现了不能编译通过，坑了整整3百。这个时候我想既然做不了 swift 后台，那我绑定一下自己的域名，发现需要备案，…。 也不知道备案是毛，然后进行备案，发现要填很多条条框框的东西，下来到最后一步需要上传文件，…..</p>
<p>各种坑的到来，使我的身心严重受挫，此路不能走，那我就走其他路，然后通过知乎，对比一些推荐的国外的云主机，我最后选择了搬瓦工的，果然国外的东西用起来没这么啰嗦，果断选了个，发现不仅可以自己更换操作系统，还可以直接绑定域名，当然我是在阿里云买的，还需要进行域名的相关设置，但是这比备案，那是简单的不能简单了。然后很愉快的就用这个服务器了。鉴于阿里云买了一年的服务器，我这次在搬瓦工仅买了一个月的，体验一下再看看。</p>
<h2 id="数据库选择"><a href="#数据库选择" class="headerlink" title="数据库选择"></a>数据库选择</h2><p>期初我的项目是跑在 heroku 上的，但是慢慢发现免费的终究有很多限制，并且它仅仅免费提供 postgresql. 其实 vapor 官方是提供的 mysql 支持的， postgresql 是社区进行维护的，其实两者在 vapor 层面基本上行是没啥大的区别。在怂恿 postgresql 的时候有个命令  “vapor prepare” 这个命令还存在问题。</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>登入服务器是用 ssh，代码托管采用 github . 所以服务器上安装 git, swift , cmysql，vapor 相关工具。<br>代码+环境准备好后，就运行项目，“vapor run”, 我们本地进行访问成功，但是当我把 ssh 的链接终端关闭，我的服务器就不能访问了， how ?</p>
<p>转到vapor 的官方文档，问题的解决方案就找到了 <a href="https://docs.vapor.codes/2.0/deploy/supervisor/" target="_blank" rel="external">Supervisor</a>。</p>
<p>为了解决端口不显示暴露，采用了 <a href="https://docs.vapor.codes/2.0/deploy/nginx/" target="_blank" rel="external">nginx</a></p>
<p>很多遇到的问题官方文档上都可以找到相应的解决方案。</p>
<h2 id="Vapor使用过程的不爽之处"><a href="#Vapor使用过程的不爽之处" class="headerlink" title="Vapor使用过程的不爽之处"></a>Vapor使用过程的不爽之处</h2><p>更改model的相关属性，数据库并没有随之更改。</p>
<h2 id="相关的命令参考"><a href="#相关的命令参考" class="headerlink" title="相关的命令参考"></a>相关的命令参考</h2><h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p>服务开启</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">service mysql start</div><div class="line">service mysql stop</div><div class="line">service mysql start</div></pre></td></tr></table></figure>
<p>utf8 问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// 修改 mysql.conf</div><div class="line">[mysqld]</div><div class="line">character-set-server=utf8</div><div class="line"></div><div class="line">[client]</div><div class="line">default-character-set=utf8</div><div class="line"></div><div class="line">[mysql]</div><div class="line">default-character-set=utf8</div><div class="line"></div><div class="line">//修改表</div><div class="line">alter table book_classifys convert to character set utf8;</div></pre></td></tr></table></figure>
<h3 id="nginx-supervisor"><a href="#nginx-supervisor" class="headerlink" title="nginx supervisor"></a>nginx supervisor</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo supervisorctl stop twicebook</div><div class="line">sudo supervisorctl start twicebook</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/05/Vapor-七牛上传-token-生成算法实现/" itemprop="url">
                  Vapor 七牛上传 token 生成算法实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-05T17:12:22+08:00" content="2017-09-05">
              2017-09-05
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/09/05/Vapor-七牛上传-token-生成算法实现/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/09/05/Vapor-七牛上传-token-生成算法实现/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> Foundation</div><div class="line"><span class="keyword">import</span> Vapor</div><div class="line"><span class="keyword">import</span> Crypto</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">QiniuToken</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">let</span> accessKey: <span class="type">String</span> = <span class="string">"Your-accessKey"</span></div><div class="line">    <span class="keyword">let</span> secretKey: <span class="type">String</span> = <span class="string">"Your-secretKey"</span></div><div class="line">    <span class="keyword">let</span> scope: <span class="type">String</span> = <span class="string">"twicebook"</span></div><div class="line">    <span class="keyword">var</span> liveTime: <span class="type">TimeInterval</span> = <span class="number">5</span></div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="function"><span class="keyword">func</span> <span class="title">genereryToken</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">try</span> <span class="type">QiniuToken</span>().gengeryToken()</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">gengeryToken</span><span class="params">()</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span>  &#123;</div><div class="line">        <span class="keyword">let</span> date = <span class="type">Date</span>().timeIntervalSince1970 + liveTime * <span class="number">24</span> * <span class="number">3600</span></div><div class="line">        <span class="keyword">let</span> authInfo: [<span class="type">String</span> : <span class="type">Any</span>] = [<span class="string">"scope"</span>: scope,<span class="string">"deadline"</span>: <span class="type">Int</span>(date)]</div><div class="line">        <span class="keyword">let</span> jsonData = <span class="keyword">try</span> <span class="type">JSONSerialization</span>.data(withJSONObject: authInfo, options: .prettyPrinted)</div><div class="line">        <span class="keyword">let</span> encodeString = urlSafeBase64Encode(jsonData)</div><div class="line">        <span class="keyword">let</span> encodedSignedString = <span class="keyword">try</span> <span class="type">HMACSHA1</span>(secretKey, text: encodeString)</div><div class="line"></div><div class="line">        <span class="keyword">let</span> token = accessKey + <span class="string">":"</span> + encodedSignedString + <span class="string">":"</span> + encodeString</div><div class="line">        <span class="keyword">return</span> token</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">HMACSHA1</span><span class="params">(<span class="number">_</span> key: String, text: String)</span></span> <span class="keyword">throws</span> -&gt; <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">let</span> hmac = <span class="keyword">try</span> <span class="type">HMAC</span>.make(.sha1, text, key: key)</div><div class="line">        <span class="keyword">let</span> hmacData = <span class="type">Data</span>(bytes: hmac)</div><div class="line">        <span class="keyword">return</span> urlSafeBase64Encode(hmacData)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">func</span> <span class="title">urlSafeBase64Encode</span><span class="params">(<span class="number">_</span> text: Data)</span></span> -&gt; <span class="type">String</span> &#123;</div><div class="line">        <span class="keyword">var</span> base64 = text.base64EncodedString()</div><div class="line">        base64 = base64.replacingOccurrences(of: <span class="string">"+"</span>, with: <span class="string">"-"</span>)</div><div class="line">        base64 = base64.replacingOccurrences(of: <span class="string">"/"</span>, with: <span class="string">"_"</span>)</div><div class="line">        <span class="keyword">return</span> base64</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h2><ul>
<li><code>deadline</code> 文档中描述值为整数。</li>
</ul>
<p>如果 <code>let authInfo: [String : Any] = [&quot;scope&quot;: scope,&quot;deadline&quot;: Int(date)]</code> 改为<br><code>let authInfo: [String : Any] = [&quot;scope&quot;: scope,&quot;deadline&quot;: Int(date)]</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Domain=qiniu.com Code=401 <span class="string">"(null)"</span> UserInfo=&#123;error=invalid put policy encoding&#125;</div></pre></td></tr></table></figure>
<p>此坑踩了一天。</p>
<ul>
<li>ios客户端上传的时候</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> config = <span class="type">QNConfiguration</span>.build(&#123; (builder) <span class="keyword">in</span></div><div class="line">                builder?.setZone(<span class="type">QNZone</span>.zone0())</div><div class="line">            &#125;)</div><div class="line"></div><div class="line"><span class="keyword">let</span> upManager = <span class="type">QNUploadManager</span>(configuration: config)</div></pre></td></tr></table></figure>
<p>关于 <code>QNZone</code> 需要跟你创建存储对象的时候所选的地区有关. <code>zone0</code> 对应的是 <code>华东</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/31/Swift-之若引用数组/" itemprop="url">
                  swift 之弱引用数组
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-31T10:28:19+08:00" content="2017-08-31">
              2017-08-31
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/08/31/Swift-之若引用数组/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/08/31/Swift-之若引用数组/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>最近在看《HeadFirst 设计模式》中的观察者模式，其中有 <code>Subject</code> 和 <code>Observer</code> 这两块，然后就联想到一个在 <code>iOS</code> 开发中一个主题更换的功能，以前是用通知中心做主题更换，但是有个缺点就是需要写个基类，然后在基类中<br>做一些共性的东西，如通知的注册，消息回调等问题， 子类重写父类，达到更换功能。</p>
<p>个人不主张使用一个超级基类，然后就想用<code>Theme</code>模块来尝试解决。</p>
<p>为了不让 <code>observer</code> 是存放到一个 Array<observable> 中的，如果是强引用的话，那这个 observable 将无法得到释放，那怎么办？ 我当时的第一想法是既然有<code>register</code>,那么就实现一个<br><code>remove</code>的操作，但是这样就得在使用地方进行 remove 操作，使得有点在使用 <code>NSNotification</code> 了.<br>那么我们可不可用数组存放弱引用指针呢？</observable></p>
<p>在stackoverflow找到了<a href="https://stackoverflow.com/questions/24127587/how-do-i-declare-an-array-of-weak-references-in-swift?answertab=votes" target="_blank" rel="external">How do I declare an array of weak references in Swift?</a></p>
<p>下面来简要介绍一下这些方案：</p>
<h2 id="创建一个通用包装器"><a href="#创建一个通用包装器" class="headerlink" title="创建一个通用包装器"></a>创建一个通用包装器</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Weak</span>&lt;<span class="title">T</span>: <span class="title">AnyObject</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">weak</span> <span class="keyword">var</span> value: <span class="type">T</span>?</div><div class="line">    <span class="keyword">init</span>(value: <span class="type">T</span>) &#123;</div><div class="line">        <span class="keyword">self</span>.value = value</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">///</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stuff</span> </span>&#123;&#125;</div><div class="line"><span class="keyword">var</span> weakly : [<span class="type">Weak</span>&lt;<span class="type">Stuff</span>&gt;] = [<span class="type">Weak</span>(value: <span class="type">Stuff</span>()), <span class="type">Weak</span>(value: <span class="type">Stuff</span>())]</div><div class="line"></div><div class="line"><span class="comment">/// 获取数组的内容</span></div><div class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Array</span> <span class="title">where</span> <span class="title">Element</span>:<span class="title">Weak</span>&lt;<span class="title">AnyObject</span>&gt; </span>&#123;</div><div class="line">  <span class="keyword">mutating</span> <span class="function"><span class="keyword">func</span> <span class="title">reap</span> <span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">self</span> = <span class="keyword">self</span>.<span class="built_in">filter</span> &#123; <span class="literal">nil</span> != $<span class="number">0</span>.value &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="使用-NSHashTable，-swift3-0"><a href="#使用-NSHashTable，-swift3-0" class="headerlink" title="使用 NSHashTable， swift3.0 +"></a>使用 NSHashTable， swift3.0 +</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSHashTable.weakObjects()</div></pre></td></tr></table></figure>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>还有很多方法，但是对我来说这两种应该是最佳的方案。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/12316547.jpeg"
               alt="loveli" />
          <p class="site-author-name" itemprop="name">loveli</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">41</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/OHeroJ" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">loveli</span>
  <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
  <span id="busuanzi_container_site_uv">
  本站访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"loveli"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  





  
  
  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


  
</body>
</html>
